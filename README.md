# Clustering tool for sparse matrices produced by USEARCH

## Motivation

The 32-bit version of USEARCH cannot process large distance matrices due to memory limitations. 
This can be a significant bottleneck when working with large sequence datasets. 
To overcome this limitation, we present a tool that performs clustering similarly to the `usearch -cluster_aggd`. 
Currently, only single linkage and complete linkage methods are implemented.  

## Quick start

First, use USEARCH to calculate the distance matrix for your sequences with a maximum distance cutoff:
```bash
usearch -calc_distmx seqs.fa -tabbedout mx.txt -maxdist 0.3
```

Next, perform the clustering using the `goclust` tool:
```bash
goclust --input mx.txt --output clusters.txt --cutoff 0.01 --method single
```

This command is an alternative to the USEARCH clustering command:
```bash 
usearch -cluster_aggd mx.txt -clusterout clusters.txt -id 0.99 -linkage min
```


## Description

The input for clustering is a "sparse" distance matrix 
estimated by `usearch -calc_distmx`, 
which only stores a subset of distances, 
omitting pairs with low identities as determined by the `maxdist` threshold. 
This significantly reduces the time and space required to compute 
and store a matrix for large sequence sets. 
Missing entries in the matrix are assumed to be at the maximum possible distance of 1.0.

## Installation

Download the `single_linkage` binary:

```bash
wget https://github.com/vmikk/single_linkage/releases/download/0.1/single_linkage
chmod +x single_linkage
./single_linkage
``` 

## Usage

The `single_linkage` tool is designed for clustering sequences based on a sparse distance matrix.   

Usage example:
```bash
single_linkage --cutoff <float> --includeequal=<bool> --input <file> --output <file>
```

Parameters:

- `--cutoff`: This parameter specifies the distance cutoff for clustering. The value must be a floating-point number greater than 0. Clusters are formed by linking sequences that have a pairwise distance less than this cutoff. A lower cutoff value will result in a larger number of smaller clusters, while a higher cutoff may produce fewer, larger clusters.

- `--input`: The path to the input file containing pairwise distances. This file should be a "sparse" matrix generated by `usearch -calc_distmx`, where each row contains the distances between a pair of sequences.

- `--output`: The path to the output file where the cluster assignments will be saved. The output file will list each sequence along with its assigned cluster label.

- `--includeequal`: This option determines whether distances equal to the specified cutoff should be included in the clustering process. By default, this option is set to true (`--includeequal=true`), allowing sequences with pairwise distances exactly equal to the cutoff to be included in the same cluster. Setting this option to false (`--includeEqual=false`) changes the clustering to only consider pairwise distances strictly greater than the cutoff value, potentially leading to more, smaller clusters.

